
{% extends 'base.html' %}

{% load static %} {% load custom_filters %}

{% block td_nav %}
  <td style="padding: 0 10px;"><a href="/display/{{db}}" class="nav">Collections</a></td>
  {% if model %}
    <td style="padding: 0 10px;">
      <a href="/add/{{db}}/{{collection}}" style="color: grey;" class="nav">Add Document</a>
    </td>
    <td style="padding: 0 10px;">
      <a href="/doc_model/{{db}}/{{collection}}" style="color: grey;" class="nav">Update Model</a>
    </td>
    <td style="padding: 0 10px; color: orange;">
      <a href="/filter/{{db}}/{{collection}}" style="color: grey;" class="nav">Filter</a>
    </td>
    <td style="padding: 0 10px; color: orange;">
      <a href="/sort/{{db}}/{{collection}}" style="color: grey;" class="nav">Sort</a>
    </td>
  {% endif %}
{% endblock %}

{% block h %}
  <h2>Documents of collection '{{collection}}'<br>
    {% if num %}
      {{num}}/{{docs_len}}
    {% else %}
      <form action="/display/{{db}}/{{collection}}" method="POST" name="clear_form">
        {% csrf_token %}
        <input type="submit" class="button" value="Clear all" name="clear">
      </form>
    {% endif %}
  </h2>
  {% if filtered or sorted %}
    <table style="margin: auto; margin-top: 20px;">
      <tr>
        {% if filtered %}
          <td style="padding: 1px 5px;">
            <div style="border: 2px solid orange; padding: 1px 5px;">
              <h3 style="color: orange;">Filter Active</h3>
            </div>
          </td>
        {% endif %}
        {% if sorted %}
          <td style="padding: 1px 5px;">
            <div style="border: 2px solid orange; padding: 1px 5px;">
              <h3 style="color: orange; ">Sort Active</h3>
            </div>
          </td>
        {% endif %}
      </tr>
      <tr>
        {% if filtered %}
          <td>
            <table style="margin: auto;">
              <tr>
                <td style="padding: 0 5px;">
                  <form action="/display/{{db}}/{{collection}}" method="POST">
                    {% csrf_token %}
                    <button type="submit" class="img_button" name="update_filter">
                      <img src="{% static 'icons/edit.ico' %}" alt="Update Filter" width="35px" height="35px">
                    </button>
                  </form>
                </td>
                <td style="padding: 0 5px;">
                  <form action="/display/{{db}}/{{collection}}" method="POST">
                    {% csrf_token %}
                    <button type="submit" class="img_button" name="delete_filter">
                      <img src="{% static 'icons/delete.ico' %}" alt="delete_filter" width="35px" height="35px">
                    </button>
                  </form>
                </td>
              </tr>
            </table>
          </td>    
        {% endif %}
        {% if sorted %}
          <td>
            <table style="margin: auto;">
              <tr>
                <td style="padding: 0 5px;">
                  <form action="/display/{{db}}/{{collection}}" method="POST">
                    {% csrf_token %}
                    <button type="submit" class="img_button" name="update_sorter">
                      <img src="{% static 'icons/edit.ico' %}" alt="Update Sort" width="35px" height="35px">
                    </button>
                  </form>
                </td>
                <td style="padding: 0 5px;">
                  <form action="/display/{{db}}/{{collection}}" method="POST">
                    {% csrf_token %}
                    <button type="submit" class="img_button" name="delete_sorter">
                      <img src="{% static 'icons/delete.ico' %}" alt="Delete Sort" width="35px" height="35px">
                    </button>
                  </form>
                </td>
              </tr>
            </table>
          </td>    
        {% endif %}
      </tr>
    </table>
  {% endif %}
{% endblock %}

{% block content %}
  <table style="margin: auto;">
    {% if model and docs %}
      <tr>
        <td style="color: blue;">NÂº</td>
        {% for attr_dict in model.values %}
          <td style="padding: 10px">
            <h3 style="color: blue;">{{attr_dict.name}}</h3>
          </td>
        {% endfor %}
      </tr>
      {% if numbers %}
        <tr>
          <td></td>
          <form action="/display/{{db}}/{{collection}}" method="POST">
            {% csrf_token %}
            {% for attr_dict in model.values %}
              <td>
                {% if attr_dict.type == 'int' or attr_dict.type == 'float' %} 
                  <select class="select" name="{{attr_dict.name}}_stat">
                    <option value="-" {% if stats and attr_dict.name|addstr:"_stat"|lookup2:stats == '-' %}selected{% endif %}> - </option>
                    <option value="avg" {% if stats and attr_dict.name|addstr:"_stat"|lookup2:stats == 'avg' %}selected{% endif %}>avg</option>
                    <option value="sum" {% if stats and attr_dict.name|addstr:"_stat"|lookup2:stats == 'sum' %}selected{% endif %}>sum</option>
                  </select> 
                {% endif %}
              </td>
            {% endfor %}
            <td>
              <button type="submit" class="button" style="padding: 1px 3px; margin: 0;" name="tick">
                <img src="{% static 'icons/tick.ico' %}" alt="Tick" width="35px" height="35px">
              </button>
            </td>
            <td>
              <button type="submit" class="button" style="padding: 1px 3px; margin: 0;" name="bin">
                <img src="{% static 'icons/delete2.ico' %}" alt="Tick" width="35px" height="35px">
              </button>
            </td>
          </form>
        </tr>
      {% endif %}
      <tr>
        {% if calculated_stats %}
          <td></td>
          {% for attr_dict in model.values %}
            <td>
              {% if attr_dict.name in calculated_stats %} 
                <div style="color: green;">
                  {{calculated_stats|lookup:attr_dict.name}}
                </div>
              {% endif %}
            </td>
          {% endfor %}
        {% endif %}
      </tr>
      <tr>
        <td></td>
        {% for attr_dict in model.values %}
          <td style="padding: 10px">
            <h3 style="color: red;">({{attr_dict.type}})</h3>
          </td>
        {% endfor %}
      </tr>
      {% for doc in docs %}
        <tr>
          <td style="color: red;">{{forloop.counter}}.</td>
          {% for attr_dict in model.values %}
            <td style="padding: 10px;">
              {% if attr_dict.type == 'password' and doc|lookup:attr_dict.name != '-' %}
                <table style="width: 100%;">
                  {% if doc|lookup:attr_dict.name not in passwords %}
                    <td>
                      <div style="white-space: pre-wrap; text-decoration: underline; color: grey; text-decoration-color: black;">{{doc|lookup:attr_dict.name}}</div>
                    </td>
                    <td style="width: 1%; padding-left: 10px;">
                      <form action="/display/{{db}}/{{collection}}" method="POST">
                        {% csrf_token %}
                        <button type="submit" class="img_button" name="lock" value="{{doc|lookup:attr_dict.name}}">
                          <img src="{% static 'icons/lock.ico' %}"
                              alt="Lock" width="35px" height="35px">
                        </button>
                      </form>
                    </td>
                  {% else %}
                    <td>
                      <div style="white-space: pre-wrap;">{{doc|lookup:attr_dict.name}}</div>
                    </td>
                    <td style="width: 1%; padding-left: 10px;">
                      <form action="/display/{{db}}/{{collection}}" method="POST">
                        {% csrf_token %}
                        <button type="submit" class="img_button" name="unlock" value="{{doc|lookup:attr_dict.name}}">
                          <img src="{% static 'icons/key.ico' %}"
                              alt="unlock" width="35px" height="35px">
                        </button>
                      </form>
                    </td>
                  {% endif %}
                </table>
              {% else %}
                <div style="white-space: pre-wrap;">{{doc|lookup:attr_dict.name}}</div>
              {% endif %}
            </td> 
          {% endfor %}
          <td style="padding-right:10px;">
            <form action="/duplicate/{{db}}/{{collection}}/{{doc.id}}" method="GET">
              <button type="submit" class="img_button">
                <img src="{% static 'icons/duplicate.ico' %}" 
                    alt="duplicate" width="35px" height="35px">
              </button>
            </form>
          </td>
          <td style="padding: 0 5px;">
            <form action="/update/{{db}}/{{collection}}/{{doc.id}}" method="GET">
              <button type="submit" class="img_button">
                <img src="{% static 'icons/edit.ico' %}" alt="update" width="35px" height="35px">
              </button>
            </form>
          </td>
          <td style="padding: 0 5px;">
            <form action="/delete/{{db}}/{{collection}}/{{doc.id}}" method="GET">
              <button type="submit" class="img_button">
                <img src="{% static 'icons/delete.ico' %}" alt="delete" width="35px" height="35px">
              </button>
            </form>
          </td>
        </tr>
      {% endfor %}
    {% else %}
      {% for doc in docs %}
        <tr>
          <td style="text-align: left;">
            <pre style="white-space: pre-wrap; word-break: break-all;"><div style="color: red;">{{forloop.counter}}:</div> {{doc}}</pre>
          </td>
        </tr>
      {% endfor %}
      {% if show_more %}
        <tr>
          <td style="padding: 0 5px;">
            <form action="/display/{{db}}/{{collection}}" method="GET">
              <button type="submit" class="button" style="padding: 1px 3px; margin: 0;" name="show_more" value="{{num}}">
                <img src="{% static 'icons/add.ico' %}" alt="show_more" width="25px" height="25px">
              </button>
            </form>
          </td>
        </tr>
      {% endif %}
    {% endif %}
  </table>
{% endblock %}